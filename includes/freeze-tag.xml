<map proto="1.4.2">
<!-- Freeze Tag gamemode include file -->
<!-- Created by mitchiii -->
<!-- Version 2024-08-23 -->
<objective>Taggers must freeze all Runners before time runs out!</objective>
<game>Freeze Tag</game>
<include id="void-death"/>
<include id="countdown"/>
<constant id="countdown-scope">team</constant>
<phase>staging</phase>
<score/>
<time result="runners">5m</time>
<teams>
    <team id="taggers" color="blue" max="3">Taggers</team>
    <team id="runners" color="green" max="12" plural="true">Runners</team>
</teams>
<kits>
    <kit id="common-kit">
        <game-mode>adventure</game-mode>
        <clear items="true" armor="true" effects="true"/>
        <item material="compass" locked="true"/>
        <chestplate material="leather chestplate" team-color="true" locked="true" unbreakable="true"/>
        <leggings material="leather leggings" team-color="true" locked="true" unbreakable="true"/>
        <boots material="leather boots" team-color="true" locked="true" unbreakable="true"/>
    </kit>
    <kit id="taggers-kit" parent="common-kit" force="true">
        <effect amplifier="2">speed</effect>
        <double-jump power="3" recharge-before-landing="true"/>
    </kit>
    <kit id="runners-kit" parent="common-kit" force="true">
        <effect>speed</effect>
    </kit>
    <kit id="runners-frozen-kit" force="true">
        <effect amplifier="-20">jump boost</effect>
        <effect amplifier="255">slowness</effect>
        <item slot="0" material="ice" locked="true"/>
        <item slot="1" material="ice" locked="true"/>
        <item slot="2" material="ice" locked="true"/>
        <item slot="3" material="ice" locked="true"/>
        <item slot="4" material="ice" locked="true"/>
        <item slot="5" material="ice" locked="true"/>
        <item slot="6" material="ice" locked="true"/>
        <item slot="7" material="ice" locked="true"/>
        <item slot="8" material="ice" locked="true"/>
        <helmet material="ice" locked="true"/>
        <chestplate material="leather chestplate" color="6699D8" locked="true" unbreakable="true"/>
        <leggings material="leather leggings" color="6699D8" locked="true" unbreakable="true"/>
        <boots material="leather boots" color="6699D8" locked="true" unbreakable="true"/>
    </kit>
</kits>
<spawns>
    <spawn team="taggers" region="spawn-region" kit="taggers-kit" filter="release-taggers"/>
    <spawn team="runners" region="spawn-region" kit="runners-kit" filter="is_frozen=0"/>
    <spawn team="runners" region="spawn-region" kit="runners-frozen-kit" filter="is_frozen=1"/>
</spawns>
<respawn delay="0s" auto="true"/>
<compass show-distance="true">
    <player filter="is_frozen=0" holder-filter="only-tagger" show-player="true"/>
    <player filter="is_frozen=1" holder-filter="only-runner" show-player="true" name="Unfreeze"/>
</compass>
<broadcasts>
    <tip after="15s" every="1m30s" filter="only-runner">Punch frozen runners to un-freeze them!</tip>
</broadcasts>
<filters>
    <all id="in-match">
        <participating id="participating"/>
        <match-running id="match-running"/>
    </all>
    <observing id="observing"/>
    <team id="only-tagger">taggers</team>
    <team id="only-runner">runners</team>
    <variable id="is-frozen" var="is_frozen">1</variable>
    <attacker id="attacker-is-tagger">
        <filter id="only-tagger"/>
    </attacker>
    <victim id="victim-is-tagger">
        <filter id="only-tagger"/>
    </victim>
    <attacker id="attacker-is-unfrozen-runner">
        <filter id="unfrozen-runner"/>
    </attacker>
    <victim id="victim-is-unfrozen-runner">
        <all id="unfrozen-runner">
            <filter id="only-runner"/>
            <not>
                <filter id="is-frozen"/>
            </not>
        </all>
    </victim>
    <victim id="victim-is-frozen-runner">
        <all id="frozen-runner">
            <filter id="only-runner"/>
            <filter id="is-frozen"/>
        </all>
    </victim>
    <after id="release-taggers" duration="5s" filter="match-running" message="Taggers will be released in {0}"/>
    <all id="countdown-start">
        <filter id="only-tagger"/>
        <time>2s</time>
    </all>
</filters>
<regions>
    <below id="in-void" y="0"/>
    <apply block="never"/>
</regions>
<control-points>
    <control-point id="win" name="Taggers Win" capture="everywhere" capture-time="1s" player-filter="only-tagger" capture-filter="runners_score=0" points="0" show-messages="false" show-effects="false" show-info="false" show-sidebar="false"/>
</control-points>
<variables>
    <score id="score"/>
    <with-team id="taggers_score" var="score" team="taggers"/>
    <with-team id="runners_score" var="score" team="runners"/>
    <variable id="counted" scope="player"/>
    <variable id="is_frozen" scope="player"/>
    <variable id="frozen_at_x" scope="player"/>
    <variable id="frozen_at_z" scope="player"/>
    <variable id="moved_from_x" scope="player"/>
    <variable id="moved_from_z" scope="player"/>
    <player-location id="x" component="x"/>
    <player-location id="y" component="y"/>
    <player-location id="z" component="z"/>
</variables>
<actions>
    <trigger scope="player">
        <filter>
            <pulse period="2s" duration="1s" filter="all(in-match, frozen-runner)"/>
        </filter>
        <action>
            <message actionbar="`b`lYou have been frozen!"/>
            <action id="has-frozen-moved"/>
        </action>
    </trigger>
    <trigger scope="player">
        <filter>
            <pulse period="2s" duration="1s">
                <after duration="1s" filter="all(in-match, frozen-runner)"/>
            </pulse>
        </filter>
        <action>
            <message actionbar="`3`lYou have been frozen!"/>
            <action id="has-frozen-moved"/>
        </action>
    </trigger>
    <action id="has-frozen-moved" scope="player">
        <set var="moved_from_x" value="frozen_at_x - x"/>
        <set var="moved_from_z" value="frozen_at_z - z"/>
    </action>
    <trigger scope="player">
        <filter>
            <pulse period="0.2s" duration="0.1s" filter="all(in-match, frozen-runner, not(any(moved_from_x=0, moved_from_z=0)))"/>
        </filter>
        <action>
            <teleport x="frozen_at_x" y="y" z="frozen_at_z"/>
        </action>
    </trigger>
    <action id="attacker-action" scope="player">
        <action filter="all(attacker-is-tagger, victim-is-unfrozen-runner)">
        </action>
        <action filter="all(attacker-is-unfrozen-runner, victim-is-frozen-runner)">
        </action>
    </action>
    <action id="victim-action" scope="player">
        <action filter="not(in-void)">
            <kit force="true">
                <health>20</health>
            </kit>
        </action>
        <action filter="all(attacker-is-tagger, victim-is-unfrozen-runner)">
            <set var="is_frozen" value="1"/>
            <set var="frozen_at_x" value="floor(x) + .5"/>
            <set var="frozen_at_z" value="floor(z) + .5"/>
            <set var="taggers_score" value="taggers_score + 1"/>
            <set var="runners_score" value="runners_score - 1"/>
            <kit id="runners-frozen-kit"/>
            <switch-scope inner="match">
                <sound key="mob.zombie.remedy" volume="0.5" pitch="1.5"/>
            </switch-scope>
        </action>
        <action filter="all(attacker-is-unfrozen-runner, victim-is-frozen-runner)">
            <set var="is_frozen" value="0"/>
            <set var="taggers_score" value="taggers_score - 1"/>
            <set var="runners_score" value="runners_score + 1"/>
            <kit id="runners-kit"/>
            <switch-scope inner="match">
                <sound key="dig.glass"/>
            </switch-scope>
        </action>
    </action>
    <trigger scope="player" filter="all(match-running, participating, only-runner, counted=0, is_frozen=0)">
        <action>
            <set var="runners_score" value="runners_score + 1"/>
            <set var="counted" value="1"/>
        </action>
    </trigger>
    <trigger scope="player" filter="all(match-running, observing, counted=1, is_frozen=0)">
        <action>
            <set var="runners_score" value="runners_score - 1"/>
            <set var="counted" value="0"/>
        </action>
    </trigger>
    <trigger scope="player" filter="all(match-running, participating, only-runner, counted=0, is_frozen=1)">
        <action>
            <set var="taggers_score" value="taggers_score + 1"/>
            <set var="counted" value="1"/>
        </action>
    </trigger>
    <trigger scope="player" filter="all(match-running, observing, counted=1, is_frozen=1)">
        <action>
            <set var="taggers_score" value="taggers_score - 1"/>
            <set var="counted" value="0"/>
        </action>
    </trigger>
</actions>
<damage attacker-action="attacker-action" victim-action="victim-action">
    <deny>
        <any>
            <cause>fall</cause>
            <all>
                <filter id="attacker-is-tagger"/>
                <filter id="victim-is-tagger"/>
            </all>
            <all>
                <filter id="attacker-is-tagger"/>
                <filter id="victim-is-frozen-runner"/>
            </all>
            <all>
                <filter id="attacker-is-unfrozen-runner"/>
                <filter id="victim-is-unfrozen-runner"/>
            </all>
            <attacker>
                <filter id="frozen-runner"/>
            </attacker>
        </any>
    </deny>
</damage>
<friendlyfire>on</friendlyfire>
<hunger>
    <depletion>off</depletion>
</hunger>
<itemremove>
    <item>ice</item>
    <item>leather helmet</item>
    <item>leather chestplate</item>
    <item>leather leggings</item>
    <item>leather boots</item>
    <item>compass</item>
</itemremove>
</map>
