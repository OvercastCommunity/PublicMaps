<map proto="1.5.0">
<!--
 ____  __.__                       _________                                              __
|    |/ _|__| ____    ____  ______ \_   ___ \  ____   ____   ________ __   ____   _______/  |_
|      < |  |/    \  / ___\/  ___/ /    \  \/ /  _ \ /    \ / ____/  |  \_/ __ \ /  ___/\   __\
|    |  \|  |   |  \/ /_/  >___ \  \     \___(  <_> )   |  < <_|  |  |  /\  ___/ \___ \  |  |
|____|__ \__|___|  /\___  /____  >  \______  /\____/|___|  /\__   |____/  \___  >____  > |__|
       \/       \//_____/     \/          \/            \/    |__|           \/     \/
-->
<!-- Created by mitchiii, based on the King's Conquest maps by Chicky -->
<!-- Version 2025.12.19 -->
<objective>Kill the enemy team's ${king-noun} to win!</objective>
<gamemode>arcade</gamemode>
<game>${king-noun} Health</game>
<respawns auto="true" spectate="true" message=" ">
    <respawn delay="0s" filter="any(phase=${phase-prematch}, sudden-death)"/>
    <respawn delay="5s" filter="phase=${phase-running}"/>
</respawns>
<time result="score">15m</time>
<constants fallback="true">
    <constant id="phase-prematch">0</constant>
    <constant id="phase-running">1</constant>
    <constant id="king-noun">King</constant>
    <constant id="kingdom-noun">Kingdom</constant>
    <constant id="team-size">16</constant>
    <constant id="team-one-name">Blue</constant> <!-- display name -->
    <constant id="team-one-color">blue</constant> <!-- text formatting color name -->
    <constant id="team-one-flag-color">blue</constant> <!-- dye color name -->
    <constant id="team-one-text-color-symbol">`9</constant> <!-- text formatting symbol ID -->
    <constant id="team-two-name">Red</constant>
    <constant id="team-two-color">dark red</constant>
    <constant id="team-two-flag-color">red</constant>
    <constant id="team-two-text-color-symbol">`4</constant>
    <constant id="world-border-end-size">25</constant>
    <constant id="king-self-damage-threshold">10</constant> <!-- amount of damage a king can self inflict within 10 seconds before being overthrown -->
    <!--
      When multiple spawns are defined:
      sudden-death-timer-start = ((480 * a) / (b - c)) + 330

      a = the shortest distance in blocks between final spawn location and the world border at its starting distance
      b = world-border-start-size
      c = world-border-end-size
    -->
    <constant id="sudden-death-timer-start">600</constant>
    <!--
        Each King's Conquest map must define the following constants in their map.xml:

        [Spawns]
        <constant id="team-one-spawn-a">0,64,0</constant>
        <constant id="team-one-yaw-a">90</constant>
        <constant id="team-two-spawn-a">0,64,0</constant>
        <constant id="team-two-yaw-a">-90</constant>

        Spawn A is also where the team colored crown banner is located for each team.
        Banner design: https://www.planetminecraft.com/banner/crown-312250/

        <constant id="team-one-spawn-b">0,64,0</constant>
        <constant id="team-one-yaw-b">90</constant>
        <constant id="team-two-spawn-b">0,64,0</constant>
        <constant id="team-two-yaw-b">-90</constant>

        <constant id="team-one-spawn-c">0,64,0</constant>
        <constant id="team-one-yaw-c">90</constant>
        <constant id="team-two-spawn-c">0,64,0</constant>
        <constant id="team-two-yaw-c">-90</constant>

        B and C spawns will be used as alternate spawn locations when the world
        border shrinks over the previous spawn point.

        Note: can be disabled with delete="true" attribute but not recommended.

        [King Race]
        <constant id="king-race-start">0,64,0</constant>
        <constant id="king-race-end">0,64,0</constant>
        <constant id="king-race-start-yaw">0</constant>

        This is the start/end points of the pre-match race to decide which player
        becomes king. The end point should have a banner with a crown design.

        Note: can be disabled with delete="true" attribute but not recommended. Will
        fallback to randomly selecting a king.

        [World Border]
        <constant id="world-border-center">0.5,0.5</constant>
        <constant id="world-border-start-size">150</constant>
        <constant id="world-border-end-size">25</constant>

        The world border will gradually shrink to 25x25 blocks (unless
        world-border-end-size is overwritten) starting at 8 minutes. The intention
        is that the world border will gradually put your spawn points out of bounds,
        moving the spawns closer to the middle, and eventually preventing respawns.

        Note: can be disabled with delete="true" attribute but not recommended. Will
        fallback to preventing respawns at 12 minutes.
    -->
</constants>
<include id="countdown"/>
<include id="void-death"/>
<teams>
    <team id="team-one" color="${team-one-color}" max="${team-size}" min="1">${team-one-name} ${king-noun}</team>
    <team id="team-two" color="${team-two-color}" max="${team-size}" min="1">${team-two-name} ${king-noun}</team>
</teams>
<spawns sequential="true" safe="true">
    <unless constant="king-race-start" constant-comparison="defined delete">
        <spawn yaw="${king-race-start-yaw}" kit="race-kit" filter="phase=${phase-prematch}">
            <region>
                <block location="${king-race-start}"/>
            </region>
        </spawn>
    </unless>
    <spawn team="team-one" yaw="${team-one-yaw-a}" filter="all(phase=${phase-running}, not(sudden-death))">
        <regions>
            <region id="team-one-spawn-point"/>
            <unless constant="team-one-spawn-b" constant-comparison="defined delete">
                <block location="${team-one-spawn-b}"/>
            </unless>
            <unless constant="team-one-spawn-c" constant-comparison="defined delete">
                <block location="${team-one-spawn-c}"/>
            </unless>
        </regions>
    </spawn>
    <spawn team="team-two" yaw="${team-two-yaw-a}" filter="all(phase=${phase-running}, not(sudden-death))">
        <regions>
            <region id="team-two-spawn-point"/>
            <unless constant="team-one-spawn-b" constant-comparison="defined delete">
                <block location="${team-two-spawn-b}"/>
            </unless>
            <unless constant="team-one-spawn-c" constant-comparison="defined delete">
                <block location="${team-two-spawn-c}"/>
            </unless>
        </regions>
    </spawn>
</spawns>
<kits>
    <kit id="race-kit" force="true">
        <game-mode>adventure</game-mode>
    </kit>
    <kit id="race-kit-spectating" force="true">
        <game-mode>spectator</game-mode>
    </kit>
    <kit id="main-kit" force="true" filter="phase=${phase-running}">
        <clear/>
        <game-mode>survival</game-mode>
        <effect duration="3" amplifier="5">strength</effect>
        <effect duration="3" amplifier="5">resistance</effect>
        <item slot="7" material="compass"/>
        <action filter="only-knight">
            <kit>
                <item slot="0" material="iron sword" unbreakable="true" prevent-sharing="true"/>
                <item slot="1" material="bow" unbreakable="true" prevent-sharing="true"/>
                <item slot="2" material="stone axe" unbreakable="true" prevent-sharing="true"/>
                <item slot="3" material="wood" amount="16"/>
                <item slot="4" material="ladder" amount="24"/>
                <item slot="5" material="arrow" amount="16"/>
                <item slot="8" material="golden apple" amount="2" consumable="consumable-gapple-weak"/>
                <helmet material="iron helmet" unbreakable="true" locked="true"/>
                <chestplate material="chainmail chestplate" unbreakable="true" locked="true"/>
                <leggings material="leather leggings" unbreakable="true" team-color="true" locked="true"/>
                <boots material="iron boots" unbreakable="true" locked="true"/>
            </kit>
        </action>
        <action filter="only-gladiator">
            <kit>
                <item slot="0" material="diamond sword" unbreakable="true" prevent-sharing="true"/>
                <item slot="1" material="stone axe" unbreakable="true" prevent-sharing="true"/>
                <item slot="2" material="wood" amount="8"/>
                <item slot="3" material="ladder" amount="24"/>
                <item slot="8" material="golden apple" amount="2" consumable="consumable-gapple-weak"/>
                <helmet material="iron helmet" unbreakable="true" locked="true"/>
                <chestplate material="diamond chestplate" unbreakable="true" locked="true"/>
                <leggings material="leather leggings" unbreakable="true" team-color="true" locked="true"/>
                <boots material="iron boots" unbreakable="true" locked="true"/>
                <walk-speed>0.7</walk-speed>
            </kit>
        </action>
        <action filter="only-crossbowman">
            <kit>
                <item slot="0" material="wood sword" unbreakable="true" prevent-sharing="true"/>
                <item slot="1" material="bow" unbreakable="true" prevent-sharing="true">
                    <enchantment level="2">arrow damage</enchantment>
                    <enchantment>arrow infinite</enchantment>
                </item>
                <item slot="2" material="stone axe" unbreakable="true" prevent-sharing="true"/>
                <item slot="3" material="wood" amount="16"/>
                <item slot="4" material="ladder" amount="24"/>
                <item slot="8" material="golden apple" amount="2" consumable="consumable-gapple-weak"/>
                <item slot="28" material="arrow" amount="1"/>
                <helmet material="chainmail helmet" unbreakable="true" locked="true"/>
                <chestplate material="chainmail chestplate" unbreakable="true" locked="true">
                    <enchantment level="2">protection projectile</enchantment>
                </chestplate>
                <leggings material="leather leggings" unbreakable="true" team-color="true" locked="true"/>
                <boots material="leather boots" unbreakable="true" team-color="true" locked="true"/>
            </kit>
        </action>
        <action filter="only-mason">
            <kit>
                <item slot="0" material="stone sword" unbreakable="true" prevent-sharing="true"/>
                <item slot="1" material="bow" unbreakable="true" prevent-sharing="true"/>
                <item slot="2" material="iron axe" unbreakable="true" prevent-sharing="true">
                    <enchantment>efficiency</enchantment>
                </item>
                <item slot="29" material="iron spade" unbreakable="true" prevent-sharing="true">
                    <enchantment>efficiency</enchantment>
                </item>
                <item slot="3" material="wood" amount="64"/>
                <item slot="4" material="glass" amount="64"/>
                <item slot="5" material="ladder" amount="48"/>
                <item slot="6" material="arrow" amount="16"/>
                <item slot="8" material="golden apple" amount="2" consumable="consumable-gapple-weak"/>
                <helmet material="chainmail helmet" unbreakable="true" locked="true"/>
                <chestplate material="leather chestplate" unbreakable="true" team-color="true" locked="true"/>
                <leggings material="leather leggings" unbreakable="true" team-color="true" locked="true"/>
                <boots material="iron boots" unbreakable="true" locked="true"/>
            </kit>
        </action>
        <action filter="only-scout">
            <kit>
                <item slot="0" material="stone sword" unbreakable="true" prevent-sharing="true"/>
                <item slot="1" material="bow" unbreakable="true" prevent-sharing="true"/>
                <item slot="2" material="stone axe" unbreakable="true" prevent-sharing="true"/>
                <item slot="3" material="wood" amount="16"/>
                <item slot="4" material="ladder" amount="48"/>
                <item slot="5" material="egg" amount="8"/>
                <item slot="6" material="arrow" amount="16"/>
                <item slot="8" material="golden apple" amount="2" consumable="consumable-gapple-weak"/>
                <helmet material="iron helmet" unbreakable="true" locked="true"/>
                <chestplate material="leather chestplate" unbreakable="true" team-color="true" locked="true"/>
                <leggings material="leather leggings" unbreakable="true" team-color="true" locked="true"/>
                <boots material="leather boots" unbreakable="true" team-color="true" locked="true"/>
                <double-jump recharge-time="8s"/>
                <walk-speed>1.2</walk-speed>
            </kit>
        </action>
    </kit>
    <kit id="king-kit" force="true" parents="main-kit, king-health-visual">
        <item slot="0" material="gold sword" unbreakable="true" prevent-sharing="true">
            <enchantment level="2">sharpness</enchantment>
        </item>
        <item slot="1" material="bow" unbreakable="true" prevent-sharing="true">
            <enchantment level="2">arrow damage</enchantment>
            <enchantment>arrow infinite</enchantment>
        </item>
        <item slot="2" material="gold axe" unbreakable="true" prevent-sharing="true"/>
        <item slot="3" material="wood" amount="16"/>
        <item slot="4" material="ladder" amount="24"/>
        <item slot="28" material="arrow"/>
        <chestplate material="gold chestplate" unbreakable="true" locked="true" enchantments="unbreaking"/>
        <leggings material="gold leggings" unbreakable="true" locked="true" enchantments="unbreaking"/>
        <boots material="gold boots" unbreakable="true" locked="true" enchantments="unbreaking"/>
        <effect amplifier="100">resistance</effect>
        <knockback-reduction>0.25</knockback-reduction>
        <walk-speed>0.9</walk-speed>
        <action>
            <set var="is_king" value="1"/>
            <action filter="not(phase-running-delayed)">
                <kit>
                    <item slot="8" material="potion" name="`r`6${king-noun}'s Berserking Warhorn" lore="`r`5Inspires fleeting strength across your ${kingdom-noun}." consumable="consumable-berserking" prevent-sharing="true">
                        <effect>regeneration</effect>
                    </item>
                </kit>
            </action>
        </action>
    </kit>
    <kit id="king-health-visual" force="true">
        <foodlevel>16</foodlevel>
        <action filter="king-health-90">
            <kit force="true">
                <health>17</health>
            </kit>
        </action>
        <action filter="king-health-80">
            <kit force="true">
                <health>15</health>
            </kit>
        </action>
        <action filter="king-health-70">
            <kit force="true">
                <health>13</health>
            </kit>
        </action>
        <action filter="king-health-60">
            <kit force="true">
                <health>11</health>
            </kit>
        </action>
        <action filter="king-health-50">
            <kit force="true">
                <health>9</health>
            </kit>
        </action>
        <action filter="king-health-40">
            <kit force="true">
                <health>7</health>
            </kit>
        </action>
        <action filter="king-health-30">
            <kit force="true">
                <health>5</health>
            </kit>
        </action>
        <action filter="king-health-20">
            <kit force="true">
                <health>3</health>
            </kit>
        </action>
        <action filter="king-health-10">
            <kit force="true">
                <health>2</health>
            </kit>
        </action>
        <action filter="king-health-00">
            <kit force="true">
                <health>1</health>
                <effect amplifier="1000" duration="0s">resistance</effect>
            </kit>
        </action>
    </kit>
    <kit id="king-berserking-kit">
        <effect duration="6" amplifier="2">strength</effect>
        <effect duration="10" amplifier="2">speed</effect>
        <action>
            <switch-scope inner="team">
                <set var="king_health_recovery_amount" value="king_health_recovery_amount + 10"/>
                <action filter="show-debug-message">
                    <message text="`7» `bKing recovery increased by 10 (beserking)"/>
                </action>
                <switch-scope inner="player">
                    <action filter="is_king=0">
                        <kit>
                            <effect duration="4">strength</effect>
                            <effect duration="10">speed</effect>
                            <effect duration="3" amplifier="4">regeneration</effect>
                        </kit>
                    </action>
                </switch-scope>
                <switch-scope inner="match">
                    <sound key="${entity.ender_dragon.growl}" volume="0.5" pitch="0.8"/>
                </switch-scope>
            </switch-scope>
            <set var="callout_player" value="1"/>
            <switch-scope inner="match">
                <message text="&#x003C;{player}&#x003E;: {message}">
                    <replacements>
                        <player id="player" var="callout_player"/>
                        <switch id="message" value="floor(random() * 5)">
                            <case match="0" result="Lay waste to their ${kingdom-noun}!"/>
                            <case match="1" result="Leave nothing but ruins in your wake!"/>
                            <case match="2" result="Conquer their ${kingdom-noun} with fury!"/>
                            <case match="3" result="Wreak havoc upon their ranks!"/>
                            <case match="4" result="Devastate their stronghold!"/>
                        </switch>
                    </replacements>
                </message>
            </switch-scope>
        </action>
    </kit>
    <kit id="king-abandon-kit">
        <foodlevel>20</foodlevel>
        <action filter="match-running">
            <set var="is_king" value="-1"/>
            <set var="king_self_damage_amount" value="0"/>
            <set var="callout_player" value="1"/>
            <message text="`cYou have abandoned your ${kingdom-noun}."/>
            <message text="`cYou cannot be recrowned as ${king-noun}."/>
            <action filter="alive">
                <kit id="main-kit"/>
            </action>
        </action>
    </kit>
    <kit id="obs-kit">
        <book show-other="false">
            <title>`e`lHow to Play</title>
            <author>mitchiii</author>
            <pages>
                <page>
                    `5» `lKING'S CONQUEST`0

                    Kill the enemy ${kingdom-noun}'s `6${king-noun} `0to win the match. The `6${king-noun} `0is located by the flag beam and compass.

                    Each `6${king-noun} `0has a maximum of `c100 HP `0shown on the scoreboard. Damaging the `6${king-noun} `0reduces their `cHP `0by `c1`0.
                </page>
            </pages>
        </book>
        <action>
            <set var="is_king" value="0"/>
        </action>
    </kit>
</kits>
<consumables>
    <consumable id="consumable-berserking" action="king-berserking-kit" on="eat"/>
    <consumable id="consumable-gapple-weak" action="gapple-weak" on="eat"/>
    <consumable id="consumable-gapple" action="gapple" on="eat"/>
</consumables>
<projectiles>
    <projectile id="projectile-flame" name="fireball" throwable="true" projectile="SmallFireball" damage="0"/>
    <projectile id="projectile-web" name="web" throwable="true" projectile="FallingBlock" material="web" velocity="2"/>
</projectiles>
<compass show-distance="true">
    <player filter="team-one-king" holder-filter="team-two" show-player="true"/>
    <player filter="team-two-king" holder-filter="team-one" show-player="true"/>
</compass>
<classes family="king" sticky="false">
    <class name="Knight" icon="iron sword" default="true" description="Attack from both close and afar">
        <kit parents="main-kit"/>
    </class>
    <class name="Gladiator" icon="diamond sword" description="Heavy armour and close combat">
        <kit parents="main-kit"/>
    </class>
    <class name="Crossbowman" icon="bow" description="Long ranged attacker">
        <kit parents="main-kit"/>
    </class>
    <class name="Mason" icon="iron axe" description="Tools and blocks to create aiding structures">
        <kit parents="main-kit"/>
    </class>
    <class name="Scout" icon="feather" description="Navigate around quickly">
        <kit parents="main-kit"/>
    </class>
</classes>
<kill-rewards>
    <kill-reward>
        <kit>
            <effect duration="3s">night vision</effect>
            <effect duration="3s">speed</effect>
        </kit>
        <item material="wood" amount="8"/>
        <item material="ladder" amount="8"/>
    </kill-reward>
    <kill-reward>
        <filter>
            <kill-streak count="2" repeat="true"/>
        </filter>
        <item material="magma cream" name="`rFireball" amount="2" projectile="projectile-flame"/>
    </kill-reward>
    <kill-reward>
        <filter>
            <kill-streak count="3" repeat="true"/>
        </filter>
        <item material="tnt" amount="2"/>
    </kill-reward>
    <kill-reward filter="only-knight">
        <item material="arrow" amount="8"/>
    </kill-reward>
    <kill-reward filter="only-gladiator">
        <item material="potion" damage="16395">
            <effect duration="2s">strength</effect>
            <effect duration="4s">speed</effect>
        </item>
    </kill-reward>
    <kill-reward filter="only-crossbowman">
        <kit>
            <effect duration="3s">strength</effect>
        </kit>
    </kill-reward>
    <kill-reward filter="only-mason">
        <item material="wood" amount="16"/>
        <item material="glass" amount="16"/>
        <item material="ladder" amount="4"/>
        <item material="arrow" amount="4"/>
    </kill-reward>
    <kill-reward filter="only-scout">
        <item material="egg" amount="8"/>
        <item material="snow ball" name="`rThrowable Web" amount="3" projectile="projectile-web"/>
        <item material="arrow" amount="4"/>
        <kit>
            <double-jump recharge-time="8s"/>
            <effect duration="3s">regeneration</effect>
        </kit>
    </kill-reward>
    <kill-reward filter="not(is_king=1)">
        <item material="golden apple" consumable="consumable-gapple-weak"/>
    </kill-reward>
    <kill-reward filter="is_king=1">
        <item material="arrow" amount="8"/>
        <item material="golden apple" damage="1" consumable="consumable-gapple"/>
    </kill-reward>
    <kill-reward>
        <filter>
            <all>
                <filter id="only-king"/>
                <kill-streak count="3" repeat="true"/>
                <not>
                    <carrying ignore-metadata="true">
                        <item material="potion" name="`r`6King's Berserking Warhorn"/>
                    </carrying>
                </not>
            </all>
        </filter>
        <item material="potion" name="`r`6${king-noun}'s Berserking Warhorn" lore="`r`5Inspires fleeting strength across your kingdom." consumable="consumable-berserking" prevent-sharing="true">
            <effect>regeneration</effect>
        </item>
    </kill-reward>
</kill-rewards>
<filters>
    <unless constant="king-race-start" constant-comparison="defined delete">
        <after id="king-race-timeout" message="A ${king-noun} will be randomly crowned in {0}" duration="30s" filter="all(match-started, phase=${phase-prematch}, not(both-teams-have-king))"/>
        <after id="conquest-started" duration="3s">
            <all id="countdown-start">
                <filter id="all(match-running-delayed, phase=${phase-prematch}, both-teams-have-king)"/>
            </all>
        </after>
    </unless>
    <if constant="king-race-start" constant-comparison="defined delete">
        <all id="conquest-started">
            <filter id="both-teams-have-king"/>
        </all>
        <all id="countdown-start">
            <never/>
        </all>
    </if>
    <deny id="deny-void">
        <void/>
    </deny>
    <after id="match-running-delayed" duration="0.2s" filter="match-running"/>
    <after id="phase-running-delayed" duration="3s" filter="phase=${phase-running}"/>
    <after id="super-dead" duration="1s" filter="all(participating, not(alive), sudden-death)"/>
    <after id="sudden-death" duration="30s" message="Sudden death begins in {0}">
        <after duration="${sudden-death-timer-start}" filter="match-running"/>
    </after>
    <after id="world-border-start" duration="30s" message="The world border will start shrinking in {0}">
        <after id="world-border-announce" duration="6m" filter="match-running"/>
    </after>
    <not id="not-king">
        <any id="only-king">
            <all id="team-one-king"><filter id="all(team-one, is_king=1)"/></all>
            <all id="team-two-king"><filter id="all(team-two, is_king=1)"/></all>
        </any>
    </not>
    <all id="both-teams-have-king">
        <players id="team-one-has-king" filter="team-one-king" observers="true"/>
        <players id="team-two-has-king" filter="team-two-king" observers="true"/>
    </all>
    <any id="own-team-has-king">
        <filter id="all(team-one, team-one-has-king)"/>
        <filter id="all(team-two, team-two-has-king)"/>
    </any>
    <all id="only-knight">
        <class>Knight</class>
        <filter id="not-king"/>
    </all>
    <all id="only-gladiator">
        <class>Gladiator</class>
        <filter id="not-king"/>
    </all>
    <all id="only-crossbowman">
        <class>Crossbowman</class>
        <filter id="not-king"/>
    </all>
    <all id="only-mason">
        <class>Mason</class>
        <filter id="not-king"/>
    </all>
    <all id="only-scout">
        <class>Scout</class>
        <filter id="not-king"/>
    </all>
    <after id="king-not-holding-flag" duration="0.1s">
        <all>
            <filter id="all(phase-running-delayed, only-king)"/>
            <not>
                <any>
                    <all>
                        <filter id="team-one"/>
                        <carrying-flag id="carrying-team-one-banner">team-one-king-banner</carrying-flag>
                    </all>
                    <all>
                        <filter id="team-two"/>
                        <carrying-flag id="carrying-team-two-banner">team-two-king-banner</carrying-flag>
                    </all>
                </any>
            </not>
        </all>
    </after>
    <flag-carried id="team-one-banner-carried">team-one-king-banner</flag-carried>
    <flag-carried id="team-two-banner-carried">team-two-king-banner</flag-carried>
    <relation id="self-inflicted-damage">neutral</relation>
    <after id="reset-king-self-inflicted-damage" filter="king_self_damage_amount=1.." duration="10s"/>
    <all id="king-has-abandoned">
        <filter id="all(phase-running-delayed, not(king-dead), not(own-team-has-king))"/>
    </all>
    <pulse id="king-has-abandoned-hurt" filter="king-has-abandoned" period="1s" duration="0.1s"/>
    <pulse id="recover-king-health" period="0.35s" duration="0.1s">
        <all>
            <score>[1,99]</score>
            <variable var="king_health_recovery_amount">[1,oo)</variable>
            <not>
                <filter id="sudden-death"/>
            </not>
        </all>
    </pulse>
    <score id="king-health-max">100</score>
    <score id="king-health-100">(90,100]</score>
    <score id="king-health-90">(80,90]</score>
    <score id="king-health-80">(70,80]</score>
    <score id="king-health-70">(60,70]</score>
    <score id="king-health-60">(50,60]</score>
    <score id="king-health-50">(40,50]</score>
    <score id="king-health-40">(30,40]</score>
    <score id="king-health-30">(20,30]</score>
    <score id="king-health-20">(10,20]</score>
    <score id="king-health-10">(1,10]</score>
    <score id="king-health-00">[-oo,1]</score>
    <score id="king-dead">[-oo,0]</score>
    <all id="allow-conquest-capture">
        <filter id="phase-running-delayed"/>
        <any>
            <filter id="all(team-one, not(own-team-has-king))"/>
            <filter id="all(team-two, not(own-team-has-king))"/>
        </any>
    </all>
    <variable id="show-debug-message" var="debug">1</variable>
    <deny id="deny-spawn-blocks">
        <blocks region="spawn-protection">
            <not>
                <material>air</material>
            </not>
        </blocks>
    </deny>
</filters>
<regions>
    <union id="initial-spawn-points">
        <block id="team-one-spawn-point" location="${team-one-spawn-a}"/>
        <block id="team-two-spawn-point" location="${team-two-spawn-a}"/>
    </union>
    <union id="spawn-protection">
        <sphere id="team-one-spawn-a-prot" origin="${team-one-spawn-a}" radius="2"/>
        <sphere id="team-two-spawn-a-prot" origin="${team-two-spawn-a}" radius="2"/>
        <unless constant="team-one-spawn-b" constant-comparison="defined delete">
            <sphere id="team-one-spawn-b-prot" origin="${team-one-spawn-b}" radius="2"/>
            <sphere id="team-two-spawn-b-prot" origin="${team-two-spawn-b}" radius="2"/>
        </unless>
        <unless constant="team-one-spawn-c" constant-comparison="defined delete">
            <sphere id="team-one-spawn-c-prot" origin="${team-one-spawn-c}" radius="2"/>
            <sphere id="team-two-spawn-c-prot" origin="${team-two-spawn-c}" radius="2"/>
        </unless>
    </union>
    <unless constant="king-race-start" constant-comparison="defined delete">
        <cylinder id="king-race-end" base="${king-race-end}" radius="1" height="3"/>
    </unless>
    <apply block="never" region="spawn-protection" message="You may not modify the spawn"/>
    <apply block-place="deny-void" message="You may not modify the void"/>
</regions>
<flags pickup-kit="king-kit" drop-kit="king-abandon-kit" carry-message="You are the ${king-noun} - Stay alive as long as possible!" show="false" show-messages="true">
    <flag id="team-one-king-banner" name="${team-one-name} ${king-noun}'s Reign" color="${team-one-flag-color}" pickup-filter="all(match-running, phase=${phase-running}, team-one, not(is_king=-1), any(is_king=1, king-has-abandoned))">
        <post recover-time="oo">${team-one-spawn-a}</post>
    </flag>
    <flag id="team-two-king-banner" name="${team-two-name} ${king-noun}'s Reign" color="${team-two-flag-color}" pickup-filter="all(match-running, phase=${phase-running}, team-two, not(is_king=-1), any(is_king=1, king-has-abandoned))">
        <post recover-time="oo">${team-two-spawn-a}</post>
    </flag>
</flags>
<score/>
<variables scope="player">
    <variable id="king_chance"/>
    <variable id="is_king"/>
    <variable id="callout_player" exclusive="1"/>
    <variable id="king_self_damage_amount"/>
</variables>
<variables scope="team">
    <variable id="king_health_recovery_amount"/>
</variables>
<variables scope="match">
    <variable id="debug" default="0"/>
    <variable id="phase"/>
    <variable id="king_chance_min"/>
    <variable id="callout_team"/>
    <score id="king_health"/>
</variables>
<replacements>
    <player id="callout-player" var="callout_player"/>
    <switch id="callout-team-kingdom" value="callout_team" scope="match">
        <case match="1" result="${team-one-text-color-symbol}${team-one-name} ${kingdom-noun}"/>
        <case match="2" result="${team-two-text-color-symbol}${team-two-name} ${kingdom-noun}"/>
    </switch>
    <switch id="callout-team-king-prefix" value="callout_team" scope="match">
        <case match="1" result="${team-one-text-color-symbol}${king-noun}"/>
        <case match="2" result="${team-two-text-color-symbol}${king-noun}"/>
    </switch>
    <switch id="callout-team-king-full" value="callout_team" scope="match">
        <case match="1" result="${team-one-text-color-symbol}${team-one-name} ${king-noun}"/>
        <case match="2" result="${team-two-text-color-symbol}${team-two-name} ${king-noun}"/>
    </switch>
</replacements>
<actions>
    <action scope="team" id="set-callout-team">
        <action filter="team-one"><set var="callout_team" value="1"/></action>
        <action filter="team-two"><set var="callout_team" value="2"/></action>
    </action>
    <trigger scope="match" filter="match-started">
        <action>
            <fill region="initial-spawn-points" material="air"/>
            <if constant="king-race-start" constant-comparison="defined delete">
                <set var="phase" value="${phase-running}"/>
                <switch-scope inner="team" filter="not(own-team-has-king)">
                    <action id="crown-random-king"/>
                </switch-scope>
            </if>
        </action>
    </trigger>
    <trigger scope="player" filter="all(is_king=1, not(match-finished))" observers="true">
        <action>
            <action filter="not(any(team-one, team-two))">
                <set var="is_king" value="0"/>
                <sound key="${block.note_block.bass}" volume="1" pitch="0.75"/>
                <message text="`cUnable to crown you ${king-noun} as you have not joined a team."/>
            </action>
            <action id="announce-king" filter="any(all(team-one, any(not(team-one-banner-carried), carrying-team-one-banner)), 
                                                   all(team-two, any(not(team-two-banner-carried), carrying-team-two-banner)))">
                <sound key="${entity.player.levelup}"/>
                <set var="callout_player" value="1"/>
                <switch-scope inner="team">
                    <action id="set-callout-team"/>
                    <action filter="not(phase=${phase-running})">
                        <set var="king_health" value="100"/>
                    </action>
                </switch-scope>
                <switch-scope inner="match">
                    <message text="{player} `bhas been crowned ${king-noun} of the {team}`b!">
                        <replacements>
                            <replacement id="player">callout-player</replacement>
                            <replacement id="team">callout-team-kingdom</replacement>
                        </replacements>
                    </message>
                    <switch-scope inner="player" filter="all(is_king=1, not(callout_player=1), any(all(team-one, callout_team=1), all(team-two, callout_team=2)))" observers="true">
                        <set var="is_king" value="0"/>
                        <sound key="${block.note_block.bass}" volume="1" pitch="0.75"/>
                        <message text="`cYou are no longer ${king-noun} of the {team}`c!">
                            <replacements>
                                <replacement id="team">callout-team-kingdom</replacement>
                            </replacements>
                        </message>
                    </switch-scope>
                </switch-scope>
                <action id="pickup-king-banner" filter="phase=${phase-running}">
                    <action filter="team-one-king"><pickup-flag flag="team-one-king-banner"/></action>
                    <action filter="team-two-king"><pickup-flag flag="team-two-king-banner"/></action>
                </action>
            </action>
        </action>
    </trigger>
    <trigger scope="player" filter="all(is_king=1, match-running, phase=${phase-prematch}, not(match-running-delayed))" action="announce-king"/>
    <trigger scope="player" filter="all(is_king=1, match-running)">
        <action>
            <message text=" "/>
            <message text="`6» » » `e`lYou are the ${king-noun} `6« « «"/>
            <action filter="phase=${phase-running}">
                <message text="`bStay alive as long as possible!"/>
            </action>
            <message text=" "/>
        </action>
    </trigger>
    <action id="crown-king" scope="player" filter="all(participating, not(own-team-has-king))">
        <switch-scope inner="team">
            <switch-scope inner="player">
                <set var="is_king" value="0"/>
                <set var="king_chance" value="99"/>
            </switch-scope>
        </switch-scope>
        <set var="is_king" value="1"/>
        <set var="king_chance" value="99"/>
    </action>
    <action id="crown-random-king" scope="team" filter="not(own-team-has-king)">
        <set var="king_chance_min" value="99"/>
        <switch-scope inner="player">
            <set var="king_chance" value="random()"/>
        </switch-scope>
        <switch-scope inner="player">
            <set var="king_chance_min" value="min(king_chance, king_chance_min)"/>
        </switch-scope>
        <switch-scope inner="player">
            <set var="is_king" value="0"/>
            <set var="king_chance" value="king_chance - king_chance_min"/>
            <action filter="king_chance=0">
                <action id="crown-king"/>
            </action>
        </switch-scope>
    </action>
    <unless constant="king-race-start" constant-comparison="defined delete">
        <trigger scope="team" filter="all(match-started, phase=${phase-prematch}, not(own-team-has-king))">
            <action>
                <message text="`bThe first player to reach the `e`lCrown Banner `bwill become ${king-noun}."/>
            </action>
        </trigger>
        <trigger scope="player" filter="all(phase=${phase-prematch}, king-race-end, not(own-team-has-king))" action="crown-king"/>
        <trigger scope="team" filter="all(king-race-timeout, not(own-team-has-king))" action="crown-random-king"/>
        <trigger scope="team" filter="all(match-running-delayed, phase=${phase-prematch}, own-team-has-king)">
            <action>
                <sound preset="OBJECTIVE_GOOD"/>
                <action filter="not(both-teams-have-king)">
                    <message text="`7`oThe Conquest will begin once the other team crowns their ${king-noun}."/>
                </action>
                <switch-scope inner="player">
                    <action filter="match-started">
                        <kit id="race-kit-spectating"/>
                    </action>
                </switch-scope>
            </action>
        </trigger>
        <trigger scope="match" filter="all(match-running-delayed, phase=${phase-prematch}, both-teams-have-king)">
            <action>
                <message text="`7`o${king-noun}s for each ${kingdom-noun} have been crowned. The Conquest will begin in 3 seconds."/>
            </action>
        </trigger>
    </unless>
    <trigger scope="match" filter="conquest-started">
        <action>
            <set var="phase" value="1"/>
            <switch-scope inner="player">
                <kit id="main-kit"/>
                <action filter="is_king=1">
                    <action id="pickup-king-banner"/>
                </action>
            </switch-scope>
        </action>
    </trigger>
    <trigger scope="match" filter="world-border-start">
        <action>
            <message text=" "/>
            <message text="`6» » » `c`lThe world border is shrinking `6« « «"/>
            <message text="`bYou will no longer be able to respawn once all spawn locations are outside of the border."/>
            <message text=" "/>
        </action>
    </trigger>
    <trigger scope="player" filter="super-dead">
        <action>
            <message text=" "/>
            <message text="`6» » » `c`lYou can no longer respawn `6« « «"/>
            <message text=" "/>
        </action>
    </trigger>
    <trigger scope="player">
        <filter>
            <all>
                <below y="-5"/>
                <filter id="super-dead"/>
            </all>
        </filter>
        <action untrigger-filter="never">
            <teleport x="player.x" y="-2" z="player.z"/>
            <kit force="true">
                <fly flying="true"/>
            </kit>
        </action>
    </trigger>
    <trigger scope="team" filter="king-has-abandoned">
        <action>
            <action id="set-callout-team"/>
            <switch-scope inner="match">
                <message text="{player} `bhas {phrase_0}{phrase_1} the {team}`b!">
                    <replacements>
                        <replacement id="player">callout-player</replacement>
                        <replacement id="team">callout-team-kingdom</replacement>
                        <switch id="phrase_0" value="floor(random() * 4)">
                            <case match="0" result=""/>
                            <case match="1" result="cowardly "/>
                            <case match="2" result="disgracefully "/>
                            <case match="3" result="shamefully "/>
                        </switch>
                        <switch id="phrase_1" value="floor(random() * 4)">
                            <case match="0" result="abandoned"/>
                            <case match="1" result="fled"/>
                            <case match="2" result="deserted"/>
                            <case match="3" result="vanished from"/>
                        </switch>
                    </replacements>
                </message>
            </switch-scope>
            <message text="`cRecover the `e`lCrown Banner `cto crown a new ${king-noun}!"/>
        </action>
    </trigger>
    <trigger scope="team" filter="king-has-abandoned-hurt">
        <action>
            <set var="king_health" value="king_health - 1"/>
            <message subtitle="`cRecover the `e`lCrown Banner`c!" fade-in="0"/>
            <action filter="king_health % 2 = 0">
                <sound key="${block.note_block.bass}" volume="2" pitch="2"/>
            </action>
            <action filter="not('king_health % 2 = 0')">
                <sound key="${block.note_block.bass}" volume="2" pitch="1"/>
            </action>
        </action>
    </trigger>
    <trigger scope="player" filter="all(match-running, is_king=1, reset-king-self-inflicted-damage)" action="king_self_damage_amount := 0"/>
    <trigger scope="player" filter="all(match-running, is_king=1, king_self_damage_amount=${king-self-damage-threshold})">
        <action>
            <action filter="team-one">
                <switch-scope inner="match">
                    <drop-flag flag="team-one-king-banner"/>
                </switch-scope>
            </action>
            <action filter="team-two">
                <switch-scope inner="match">
                    <drop-flag flag="team-two-king-banner"/>
                </switch-scope>
            </action>
        </action>
    </trigger>
    <!-- kills the king when they get negative health through non contact damage -->
    <trigger scope="player" filter="all(phase-running-delayed, alive, is_king=1, king-dead)">
        <action untrigger-filter="never">
            <kit>
                <clear effects="true"/>
                <effect amplifier="50">instant damage</effect>
            </kit>
        </action>
    </trigger>
    <trigger scope="player" filter="all(phase-running-delayed, alive, king-not-holding-flag)" action="is_king := 0"/>
    <trigger scope="team" filter="all(king-health-max, king_health_recovery_amount=1..)">
        <action>
            <set var="king_health_recovery_amount" value="0"/>
            <action filter="show-debug-message">
                <message text="`7» `bKing recovery reset to 0 (max health)"/>
            </action>
        </action>
    </trigger>
    <trigger scope="team" filter="recover-king-health">
        <action>
            <set var="king_health" value="king_health + 1"/>
            <set var="king_health_recovery_amount" value="king_health_recovery_amount-1"/>
            <action filter="show-debug-message">
                <message text="`7» `eKing health increased by 1"/>
                <message text="`7» `bKing recovery reduced by 1"/>
            </action>
            <switch-scope filter="is_king=1" inner="player">
                <kit id="king-health-visual"/>
            </switch-scope>
        </action>
    </trigger>
    <trigger scope="match" filter="sudden-death">
        <action>
            <sound key="${entity.lightning_bolt.thunder}"/>
            <message text=" "/>
            <message text="`6» » » `c`lSUDDEN DEATH `6« « «" title="`6» » » `c`lSUDDEN DEATH `6« « «"/>
            <switch-scope filter="all(not(is_king=1), participating, alive)" inner="player">
                <message text="`cYou can no longer respawn!" subtitle="`cYou can no longer respawn!"/>
            </switch-scope>
            <switch-scope filter="all(is_king=1, participating, alive)" inner="player">
                <kit id="king-health-visual"/>
                <message text="`cYou can no longer regenerate health!" subtitle="`cYou can no longer regenerate health!"/>
            </switch-scope>
            <message text=" "/>
            <switch-scope inner="team">
                <set var="king_health_recovery_amount" value="0"/>
            </switch-scope>
        </action>
    </trigger>
    <trigger scope="team" filter="all(phase-running-delayed, king-dead)">
        <action>
            <set var="king_health" value="0"/>
            <action filter="show-debug-message">
                <message text="`7» `eKing health set to 0 (death)"/>
            </action>
            <action id="set-callout-team"/>
            <switch-scope inner="player" filter="is_king=1">
                <set var="callout_player" value="1"/>
            </switch-scope>
            <switch-scope inner="match">
                <sound preset="OBJECTIVE_FIREWORKS_TWINKLE"/>
                <message text=" "/>
                <action filter="any(all(callout_team=1, team-one-has-king), all(callout_team=2, team-two-has-king))">
                    <message text="`6» » » {noun} {player} `chas been eliminated! `6« « «">
                        <replacements>
                            <player id="player" var="callout_player" style="color"/>
                            <replacement id="noun">callout-team-king-prefix</replacement>
                        </replacements>
                    </message>
                </action>
                <action filter="any(all(callout_team=1, not(team-one-has-king)), all(callout_team=2, not(team-two-has-king)))">
                    <message text="`6» » » {team} `chas been eliminated! `6« « «">
                        <replacements>
                            <replacement id="team">callout-team-king-full</replacement>
                        </replacements>
                    </message>
                </action>
                <message text=" "/>
                <set var="timelimit" value="0"/>
            </switch-scope>
        </action>
    </trigger>
    <action scope="player" id="gapple-weak">
        <action filter="is_king=1">
            <switch-scope inner="team">
                <set var="king_health_recovery_amount" value="king_health_recovery_amount + 1"/>
                <action filter="show-debug-message">
                    <message text="`7» `bKing recovery increased by 1 (gapple)"/>
                </action>
            </switch-scope>
        </action>
        <action filter="not(is_king=1)">
            <kit force="true">
                <effect duration="5s" amplifier="2">regeneration</effect>
                <effect duration="2m">absorption</effect>
            </kit>
        </action>
    </action>
    <action scope="player" id="gapple">
        <action filter="is_king=1">
            <switch-scope inner="team">
                <set var="king_health_recovery_amount" value="king_health_recovery_amount + 6"/>
                <action filter="show-debug-message">
                    <message text="`7» `bKing recovery increased by 6 (king gapple)"/>
                </action>
            </switch-scope>
        </action>
        <action filter="not(is_king=1)">
            <kit force="true">
                <effect duration="5s" amplifier="2">regeneration</effect>
                <effect duration="2m">absorption</effect>
            </kit>
        </action>
    </action>
    <action scope="player" id="victim-action" filter="all(is_king=1, king_health=1..)">
        <set var="king_health" value="king_health - 1"/>
        <kit id="king-health-visual"/>
        <action filter="self-inflicted-damage">
            <set var="king_self_damage_amount" value="king_self_damage_amount + 1"/>
            <action filter="show-debug-message">
                <message text="`7» `bAccumulated self damage: {dmg}">
                    <replacements>
                        <decimal id="dmg" value="king_self_damage_amount"/>
                    </replacements>
                </message>
            </action>
        </action>
        <action filter="all(not(self-inflicted-damage), king_self_damage_amount=1..)">
            <set var="king_self_damage_amount" value="max(king_self_damage_amount - 3, 0)"/>
        </action>
    </action>
</actions>
<damage victim-action="victim-action">
    <deny>
        <all>
            <variable var="phase">0</variable>
            <not>
                <below y="0"/>
            </not>
        </all>
    </deny>
</damage>
<unless constant="king-race-start" constant-comparison="defined delete">
    <portals sound="false">
        <portal forward="all(team-one, conquest-started)" destination="team-one-spawn-point" yaw="@${team-one-yaw-a}" pitch="@0"/>
        <portal forward="all(team-two, conquest-started)" destination="team-two-spawn-point" yaw="@${team-two-yaw-a}" pitch="@0"/>
    </portals>
</unless>
<unless constant="world-border-center" constant-comparison="defined delete">
    <world-borders center="${world-border-center}" buffer="1">
        <world-border size="${world-border-start-size}" after="6m"/>
        <world-border size="${world-border-end-size}" after="6m30s" duration="4m"/>
        <world-border size="1" after="10m30s" duration="5m"/>
    </world-borders>
</unless>
<tnt>
    <instantignite>on</instantignite>
</tnt>
<crafting>
    <disable>wood pickaxe</disable>
    <disable>stone pickaxe</disable>
    <disable>iron pickaxe</disable>
    <disable>gold pickaxe</disable>
    <disable>diamond pickaxe</disable>
    <disable>sandstone</disable>
</crafting>
<itemremove>
    <item>wood sword</item>
    <item>wood pickaxe</item>
    <item>wood axe</item>
    <item>leather helmet</item>
    <item>leather chestplate</item>
    <item>leather leggings</item>
    <item>leather boots</item>
    <item>stone sword</item>
    <item>chainmail helmet</item>
    <item>chainmail chestplate</item>
    <item>chainmail leggings</item>
    <item>chainmail boots</item>
    <item>gold sword</item>
    <item>gold pickaxe</item>
    <item>gold helmet</item>
    <item>gold chestplate</item>
    <item>gold leggings</item>
    <item>gold boots</item>
    <item>iron sword</item>
    <item>iron pickaxe</item>
    <item>iron axe</item>
    <item>iron spade</item>
    <item>iron helmet</item>
    <item>iron chestplate</item>
    <item>iron leggings</item>
    <item>iron boots</item>
    <item>diamond sword</item>
    <item>diamond pickaxe</item>
    <item>diamond axe</item>
    <item>diamond spade</item>
    <item>diamond helmet</item>
    <item>diamond chestplate</item>
    <item>diamond leggings</item>
    <item>diamond boots</item>
    <item>compass</item>
    <item>shears</item>
    <item>bow</item>
    <item>arrow</item>
    <item>apple</item>
    <item>potion</item>
    <item>glass bottle</item>
    <item>sapling</item>
    <item>snow ball</item>
    <item>anvil</item>
    <item>brick</item>
    <item>brick stairs</item>
    <item>coal block</item>
    <item>cobblestone</item>
    <item>cobblestone stairs</item>
    <item>cobble wall</item>
    <item>diamond block</item>
    <item>dispenser</item>
    <item>dropper</item>
    <item>egg</item>
    <item>emerald block</item>
    <item>furnace</item>
    <item>gold block</item>
    <item>hard clay</item>
    <item>hopper</item>
    <item>iron fence</item>
    <item>iron block</item>
    <item>iron door</item>
    <item>magma cream</item>
    <item>mossy cobblestone</item>
    <item>nether brick</item>
    <item>nether brick stairs</item>
    <item>nether fence</item>
    <item>netherrack</item>
    <item>prismarine</item>
    <item>quartz block</item>
    <item>quartz stairs</item>
    <item>red sandstone</item>
    <item>red sandstone stairs</item>
    <item>sandstone</item>
    <item>sandstone stairs</item>
    <item>skull item</item>
    <item>smooth brick</item>
    <item>smooth stairs</item>
    <item>stained clay</item>
    <item>step</item>
    <item>stone</item>
    <item>string</item>
    <item>web</item>
</itemremove>
<itemkeep>
    <item>torch</item>
    <item>ladder</item>
    <item>cobblestone</item>
    <item>wood</item>
    <item>ladder</item>
    <item>glass</item>
    <item>wood</item>
    <item>arrow</item>
    <item>golden apple</item>
</itemkeep>
<hunger>
    <depletion>off</depletion>
</hunger>
</map>
